<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Twoj projekt - tomekniedzwiecki.pl</title>
    <link rel="icon" type="image/svg+xml" href="/favicon-tn.svg">
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
    <script src="https://unpkg.com/@phosphor-icons/web"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/bcryptjs/2.4.3/bcrypt.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                        mono: ['JetBrains Mono', 'monospace'],
                    }
                }
            }
        }
    </script>
    <style>
        body { background: #0a0a0a; color: #ededed; }

        ::-webkit-scrollbar { width: 6px; height: 6px; }
        ::-webkit-scrollbar-track { background: transparent; }
        ::-webkit-scrollbar-thumb { background: #333; border-radius: 3px; }
        ::-webkit-scrollbar-thumb:hover { background: #555; }
        ::selection { background: white; color: black; }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(8px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .animate-enter { animation: fadeIn 0.3s ease-out forwards; }

        /* Vercel-style design tokens */
        .border-default { border-color: #222; }
        .bg-card { background: #111; }
        .bg-hover { background: #171717; }
        .text-secondary { color: #888; }
        .text-tertiary { color: #666; }

        /* Tabs */
        .tab-nav {
            display: flex;
            gap: 0;
            border-bottom: 1px solid #222;
            overflow-x: auto;
            scrollbar-width: none;
            -ms-overflow-style: none;
        }
        .tab-nav::-webkit-scrollbar { display: none; }
        .tab-btn {
            padding: 12px 16px;
            font-size: 14px;
            color: #666;
            border-bottom: 2px solid transparent;
            margin-bottom: -1px;
            white-space: nowrap;
            transition: all 0.15s ease;
        }
        .tab-btn:hover { color: #888; }
        .tab-btn.active { color: #fff; border-color: #fff; }

        /* Progress ring */
        .progress-ring { transform: rotate(-90deg); }
        .progress-ring-bg { stroke: #222; }
        .progress-ring-fill {
            stroke: #10b981;
            stroke-linecap: round;
            transition: stroke-dashoffset 0.5s ease;
        }

        /* Cards */
        .card {
            background: #111;
            border: 1px solid #222;
            border-radius: 12px;
        }
        .card-hover:hover {
            border-color: #333;
            background: #141414;
        }

        /* Milestone */
        .milestone-card { transition: all 0.15s ease; }
        .milestone-card:hover { border-color: #333; }
        .milestone-card.active { border-color: #333; }
        .milestone-card.completed { border-color: rgba(16, 185, 129, 0.3); }

        /* Form inputs */
        .form-input {
            width: 100%;
            background: #0a0a0a;
            border: 1px solid #333;
            border-radius: 8px;
            padding: 10px 14px;
            color: #ededed;
            font-size: 14px;
            transition: all 0.15s ease;
        }
        .form-input:hover { border-color: #444; }
        .form-input:focus { border-color: #666; outline: none; }
        .form-input::placeholder { color: #555; }

        /* Badges */
        .badge {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 4px 10px;
            border-radius: 6px;
            font-size: 12px;
            font-weight: 500;
        }
        .badge-emerald { background: rgba(16, 185, 129, 0.1); color: #10b981; }
        .badge-amber { background: rgba(245, 158, 11, 0.1); color: #f59e0b; }
        .badge-blue { background: rgba(59, 130, 246, 0.1); color: #3b82f6; }
        .badge-violet { background: rgba(139, 92, 246, 0.1); color: #a78bfa; }

        /* Responsible badges */
        .responsible-team { background: rgba(139, 92, 246, 0.1); color: #a78bfa; border: 1px solid rgba(139, 92, 246, 0.2); }
        .responsible-client { background: rgba(6, 182, 212, 0.1); color: #22d3ee; border: 1px solid rgba(6, 182, 212, 0.2); }
        .responsible-shared { background: rgba(245, 158, 11, 0.1); color: #fbbf24; border: 1px solid rgba(245, 158, 11, 0.2); }

        /* Comment bubbles */
        .comment-team { background: #171717; border: 1px solid #222; }
        .comment-client { background: rgba(139, 92, 246, 0.1); border: 1px solid rgba(139, 92, 246, 0.2); }
    </style>
</head>
<body class="min-h-screen font-sans antialiased">

    <!-- Loading Screen -->
    <div id="loading-screen" class="min-h-screen flex items-center justify-center">
        <div class="text-center animate-enter">
            <div class="w-8 h-8 mx-auto mb-4 border-2 border-zinc-800 border-t-white rounded-full animate-spin"></div>
            <p class="text-secondary text-sm">Ladowanie projektu...</p>
        </div>
    </div>

    <!-- Not Found Screen -->
    <div id="not-found-screen" class="hidden min-h-screen flex items-center justify-center p-4">
        <div class="text-center animate-enter max-w-md">
            <div class="w-16 h-16 mx-auto mb-6 rounded-full bg-zinc-900 flex items-center justify-center">
                <i class="ph ph-warning text-3xl text-amber-400"></i>
            </div>
            <h1 class="text-2xl font-semibold text-white mb-3">Projekt nie znaleziony</h1>
            <p class="text-secondary">Link do projektu jest nieprawidlowy lub wygasl. Skontaktuj sie z zespolem.</p>
        </div>
    </div>

    <!-- Set Password Screen (First Time) -->
    <div id="set-password-screen" class="hidden min-h-screen flex items-center justify-center p-4">
        <div class="w-full max-w-md animate-enter">
            <div class="text-center mb-8">
                <div class="w-12 h-12 mx-auto mb-4 rounded-full bg-emerald-500/10 flex items-center justify-center">
                    <i class="ph ph-lock-key text-xl text-emerald-400"></i>
                </div>
                <h1 class="text-xl font-semibold text-white mb-2">Ustaw haslo dostepu</h1>
                <p class="text-secondary text-sm">Utworz haslo, ktorego bedziesz uzywac do logowania do projektu.</p>
            </div>

            <div class="card p-6">
                <form onsubmit="setPassword(event)">
                    <div class="mb-4">
                        <label class="block text-secondary text-sm mb-2">Haslo</label>
                        <input type="password" id="set-password-input" class="form-input" placeholder="Minimum 6 znakow" required minlength="6">
                    </div>
                    <div class="mb-6">
                        <label class="block text-secondary text-sm mb-2">Potwierdz haslo</label>
                        <input type="password" id="set-password-confirm" class="form-input" placeholder="Powtorz haslo" required>
                    </div>
                    <button type="submit" class="w-full bg-white text-black hover:bg-zinc-200 py-3 rounded-lg font-medium transition-colors">
                        Ustaw haslo
                    </button>
                </form>
            </div>
        </div>
    </div>

    <!-- Password Screen (Login) -->
    <div id="password-screen" class="hidden min-h-screen flex items-center justify-center p-4">
        <div class="w-full max-w-md animate-enter">
            <div class="text-center mb-8">
                <div class="w-12 h-12 mx-auto mb-4 rounded-full bg-zinc-900 flex items-center justify-center">
                    <i class="ph ph-lock text-xl text-zinc-400"></i>
                </div>
                <h1 class="text-xl font-semibold text-white mb-2">Zaloguj sie</h1>
                <p class="text-secondary text-sm">Wprowadz haslo, aby uzyskac dostep do projektu.</p>
            </div>

            <div class="card p-6">
                <form onsubmit="checkPassword(event)">
                    <div class="mb-6">
                        <label class="block text-secondary text-sm mb-2">Haslo</label>
                        <input type="password" id="password-input" class="form-input" placeholder="Wprowadz haslo" required>
                    </div>
                    <button type="submit" class="w-full bg-white text-black hover:bg-zinc-200 py-3 rounded-lg font-medium transition-colors">
                        Zaloguj
                    </button>
                </form>
            </div>
        </div>
    </div>

    <!-- Contract Data Screen -->
    <div id="contract-data-screen" class="hidden min-h-screen flex items-center justify-center p-4 py-12">
        <div class="w-full max-w-2xl animate-enter">
            <div class="text-center mb-8">
                <div class="inline-flex items-center gap-2 px-3 py-1 rounded-full bg-emerald-500/10 text-emerald-400 text-xs font-medium mb-4">
                    <i class="ph ph-check-circle"></i>
                    Krok 1 z 2
                </div>
                <h1 class="text-2xl font-semibold text-white mb-2">Dane do umowy</h1>
                <p class="text-secondary">Wprowadz dane potrzebne do przygotowania umowy.</p>
            </div>

            <div class="card p-6 md:p-8">
                <form onsubmit="submitContractData(event)">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
                        <div>
                            <label class="block text-secondary text-sm mb-2">Imie i nazwisko *</label>
                            <input type="text" id="contract-name" class="form-input" required>
                        </div>
                        <div>
                            <label class="block text-secondary text-sm mb-2">Firma (opcjonalnie)</label>
                            <input type="text" id="contract-company" class="form-input">
                        </div>
                    </div>

                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
                        <div>
                            <label class="block text-secondary text-sm mb-2">PESEL *</label>
                            <input type="text" id="contract-pesel" class="form-input" maxlength="11" required>
                            <p id="pesel-error" class="text-red-400 text-xs mt-1 hidden"></p>
                        </div>
                        <div>
                            <label class="block text-secondary text-sm mb-2">Nr dowodu osobistego *</label>
                            <input type="text" id="contract-id" class="form-input" maxlength="9" required>
                            <p id="id-error" class="text-red-400 text-xs mt-1 hidden"></p>
                        </div>
                    </div>

                    <div class="mb-6">
                        <label class="block text-secondary text-sm mb-2">NIP (opcjonalnie)</label>
                        <input type="text" id="contract-nip" class="form-input" maxlength="10">
                    </div>

                    <div class="mb-6">
                        <label class="block text-secondary text-sm mb-2">Ulica i numer *</label>
                        <input type="text" id="contract-street" class="form-input" required>
                    </div>

                    <div class="grid grid-cols-2 md:grid-cols-3 gap-4 mb-6">
                        <div>
                            <label class="block text-secondary text-sm mb-2">Kod pocztowy *</label>
                            <input type="text" id="contract-postal" class="form-input" placeholder="00-000" required>
                        </div>
                        <div>
                            <label class="block text-secondary text-sm mb-2">Miasto *</label>
                            <input type="text" id="contract-city" class="form-input" required>
                        </div>
                        <div class="col-span-2 md:col-span-1">
                            <label class="block text-secondary text-sm mb-2">Kraj *</label>
                            <input type="text" id="contract-country" class="form-input" value="Polska" required>
                        </div>
                    </div>

                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-8">
                        <div>
                            <label class="block text-secondary text-sm mb-2">Email *</label>
                            <input type="email" id="contract-email" class="form-input" required>
                        </div>
                        <div>
                            <label class="block text-secondary text-sm mb-2">Telefon</label>
                            <input type="tel" id="contract-phone" class="form-input">
                        </div>
                    </div>

                    <button type="submit" class="w-full bg-white text-black hover:bg-zinc-200 py-3 rounded-lg font-medium transition-colors flex items-center justify-center gap-2">
                        Dalej
                        <i class="ph ph-arrow-right"></i>
                    </button>
                </form>
            </div>
        </div>
    </div>

    <!-- Contract Signing Screen -->
    <div id="contract-signing-screen" class="hidden min-h-screen flex items-center justify-center p-4 py-12">
        <div class="w-full max-w-2xl animate-enter">
            <div class="text-center mb-8">
                <div class="inline-flex items-center gap-2 px-3 py-1 rounded-full bg-violet-500/10 text-violet-400 text-xs font-medium mb-4">
                    <i class="ph ph-signature"></i>
                    Krok 2 z 2
                </div>
                <h1 class="text-2xl font-semibold text-white mb-2">Podpisanie umowy</h1>
                <p class="text-secondary">Pobierz umowe, podpisz ja i przeslij do nas.</p>
            </div>

            <div class="card p-6 md:p-8 mb-6">
                <div class="flex items-center gap-4 p-4 bg-zinc-900 rounded-lg mb-6">
                    <div class="w-12 h-12 rounded-lg bg-red-500/10 flex items-center justify-center flex-shrink-0">
                        <i class="ph ph-file-pdf text-2xl text-red-400"></i>
                    </div>
                    <div class="flex-1 min-w-0">
                        <p class="text-white font-medium">Umowa do podpisu</p>
                        <p class="text-secondary text-sm">Dokument PDF</p>
                    </div>
                    <a id="download-contract-btn" href="#" target="_blank" class="bg-white text-black hover:bg-zinc-200 px-4 py-2 rounded-lg text-sm font-medium transition-colors flex items-center gap-2">
                        <i class="ph ph-download-simple"></i>
                        Pobierz
                    </a>
                </div>

                <div class="space-y-4">
                    <h3 class="text-white font-medium">Jak podpisac umowe?</h3>

                    <div class="p-4 border border-emerald-500/20 bg-emerald-500/5 rounded-lg">
                        <div class="flex items-start gap-3">
                            <div class="w-6 h-6 rounded-full bg-emerald-500/20 flex items-center justify-center flex-shrink-0 mt-0.5">
                                <span class="text-emerald-400 text-xs font-bold">1</span>
                            </div>
                            <div>
                                <p class="text-white font-medium mb-1">Podpis zaufany (gov.pl)</p>
                                <p class="text-secondary text-sm">Najszybsza opcja. Podpisz bezplatnie przez profil zaufany na <a href="https://www.gov.pl/web/podpis-zaufany" target="_blank" class="text-emerald-400 hover:underline">gov.pl</a>.</p>
                            </div>
                        </div>
                    </div>

                    <div class="p-4 border border-white/5 rounded-lg">
                        <div class="flex items-start gap-3">
                            <div class="w-6 h-6 rounded-full bg-zinc-800 flex items-center justify-center flex-shrink-0 mt-0.5">
                                <span class="text-zinc-400 text-xs font-bold">2</span>
                            </div>
                            <div>
                                <p class="text-white font-medium mb-1">Podpis kwalifikowany</p>
                                <p class="text-secondary text-sm">Jesli posiadasz certyfikat kwalifikowany (np. Certum, Sigillum).</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="card p-6">
                <p class="text-secondary text-sm mb-4">
                    <i class="ph ph-info text-blue-400 mr-1"></i>
                    Po podpisaniu umowy wyslij ja do nas mailem. Otrzymasz powiadomienie gdy umowa zostanie zaakceptowana.
                </p>
                <button onclick="goToProject()" class="w-full bg-zinc-800 hover:bg-zinc-700 text-white py-3 rounded-lg font-medium transition-colors">
                    Przejdz do projektu
                </button>
            </div>
        </div>
    </div>

    <!-- Main Project Screen -->
    <div id="project-screen" class="hidden min-h-screen">
        <!-- Header -->
        <header class="border-b border-default sticky top-0 bg-[#0a0a0a]/80 backdrop-blur-lg z-40">
            <div class="max-w-6xl mx-auto px-4 md:px-6">
                <div class="flex items-center justify-between h-16">
                    <div class="flex items-center gap-3">
                        <div class="w-8 h-8 rounded-lg bg-gradient-to-br from-violet-500 to-purple-600 flex items-center justify-center">
                            <span class="text-white text-xs font-bold">TN</span>
                        </div>
                        <div>
                            <h1 id="project-title" class="text-white font-semibold">Projekt</h1>
                            <p id="project-subtitle" class="text-tertiary text-xs hidden md:block">tomekniedzwiecki.pl</p>
                        </div>
                    </div>
                    <div class="flex items-center gap-3">
                        <span id="project-status-badge" class="badge badge-emerald">
                            <span class="w-1.5 h-1.5 rounded-full bg-current"></span>
                            Aktywny
                        </span>
                    </div>
                </div>

                <!-- Tabs -->
                <nav class="tab-nav -mb-px">
                    <button onclick="switchTab('projekt')" data-tab="projekt" class="tab-btn active">
                        <i class="ph ph-house mr-1.5"></i>
                        Projekt
                    </button>
                    <button onclick="switchTab('dokumenty')" data-tab="dokumenty" class="tab-btn">
                        <i class="ph ph-file-text mr-1.5"></i>
                        Dokumenty
                    </button>
                    <button onclick="switchTab('materialy')" data-tab="materialy" class="tab-btn">
                        <i class="ph ph-folder-open mr-1.5"></i>
                        Materialy
                    </button>
                    <button onclick="switchTab('branding')" data-tab="branding" class="tab-btn">
                        <i class="ph ph-paint-brush mr-1.5"></i>
                        Branding
                    </button>
                    <button onclick="switchTab('strona')" data-tab="strona" class="tab-btn">
                        <i class="ph ph-globe mr-1.5"></i>
                        Strona
                    </button>
                    <button onclick="switchTab('produkty')" data-tab="produkty" class="tab-btn">
                        <i class="ph ph-package mr-1.5"></i>
                        Produkty
                    </button>
                    <button onclick="switchTab('raporty')" data-tab="raporty" class="tab-btn">
                        <i class="ph ph-chart-line-up mr-1.5"></i>
                        Raporty
                    </button>
                    <button onclick="switchTab('komentarze')" data-tab="komentarze" class="tab-btn">
                        <i class="ph ph-chat-circle-text mr-1.5"></i>
                        Komentarze
                    </button>
                </nav>
            </div>
        </header>

        <!-- Main Content -->
        <main class="max-w-6xl mx-auto px-4 md:px-6 py-8">

            <!-- TAB: Projekt -->
            <div id="tab-projekt" class="tab-panel animate-enter">
                <!-- Progress Overview -->
                <div class="grid grid-cols-1 lg:grid-cols-3 gap-6 mb-8">
                    <!-- Progress Card -->
                    <div class="card p-6 flex items-center gap-6">
                        <div class="relative">
                            <svg class="progress-ring w-24 h-24" viewBox="0 0 100 100">
                                <circle class="progress-ring-bg" cx="50" cy="50" r="42" fill="none" stroke-width="8"/>
                                <circle id="progress-ring-fill" class="progress-ring-fill" cx="50" cy="50" r="42" fill="none" stroke-width="8" stroke-dasharray="264" stroke-dashoffset="264"/>
                            </svg>
                            <div class="absolute inset-0 flex items-center justify-center">
                                <span id="progress-percent" class="text-2xl font-bold text-white">0%</span>
                            </div>
                        </div>
                        <div>
                            <p class="text-secondary text-sm mb-1">Postep projektu</p>
                            <p class="text-white text-lg font-semibold"><span id="completed-tasks">0</span> / <span id="total-tasks">0</span> zadan</p>
                        </div>
                    </div>

                    <!-- Current Milestone Card -->
                    <div class="card p-6">
                        <p class="text-secondary text-sm mb-2">Aktualny etap</p>
                        <p id="current-milestone" class="text-white text-lg font-semibold mb-2">-</p>
                        <div class="flex items-center gap-2 text-sm">
                            <i class="ph ph-calendar text-tertiary"></i>
                            <span class="text-secondary">Deadline:</span>
                            <span id="current-deadline" class="text-white">-</span>
                        </div>
                    </div>

                    <!-- Project Info Card -->
                    <div class="card p-6">
                        <p class="text-secondary text-sm mb-2">Projekt</p>
                        <p id="offer-name" class="text-white text-lg font-semibold mb-2">-</p>
                        <div class="flex items-center gap-2 text-sm">
                            <i class="ph ph-calendar-check text-tertiary"></i>
                            <span class="text-secondary">Start:</span>
                            <span id="started-at" class="text-white">-</span>
                        </div>
                    </div>
                </div>

                <!-- Milestones -->
                <div>
                    <h2 class="text-lg font-semibold text-white mb-4">Etapy realizacji</h2>
                    <div id="milestones-container" class="space-y-4">
                        <!-- Milestones rendered here -->
                    </div>
                </div>
            </div>

            <!-- TAB: Dokumenty -->
            <div id="tab-dokumenty" class="tab-panel hidden">
                <h2 class="text-lg font-semibold text-white mb-6">Dokumenty</h2>

                <!-- Signed Contract Section -->
                <div id="signed-contract-section" class="hidden mb-6">
                    <div class="card p-5 border-emerald-500/20 bg-emerald-500/5">
                        <div class="flex items-center justify-between">
                            <div class="flex items-center gap-4">
                                <div class="w-12 h-12 rounded-lg bg-emerald-500/10 flex items-center justify-center">
                                    <i class="ph ph-seal-check text-2xl text-emerald-400"></i>
                                </div>
                                <div>
                                    <p class="text-white font-medium">Podpisana umowa</p>
                                    <p class="text-emerald-400 text-sm">Umowa podpisana przez obie strony</p>
                                </div>
                            </div>
                            <a id="signed-contract-download" href="#" target="_blank" class="bg-emerald-600 hover:bg-emerald-700 text-white px-4 py-2 rounded-lg text-sm font-medium transition-colors flex items-center gap-2">
                                <i class="ph ph-download-simple"></i>
                                Pobierz
                            </a>
                        </div>
                    </div>
                </div>

                <div id="documents-list" class="space-y-3">
                    <!-- Documents rendered here -->
                </div>

                <div id="documents-empty" class="text-center py-16">
                    <div class="w-16 h-16 mx-auto mb-4 rounded-full bg-zinc-900 flex items-center justify-center">
                        <i class="ph ph-file-text text-2xl text-zinc-600"></i>
                    </div>
                    <p class="text-secondary">Brak dokumentow</p>
                </div>
            </div>

            <!-- TAB: Materialy -->
            <div id="tab-materialy" class="tab-panel hidden">
                <h2 class="text-lg font-semibold text-white mb-6">Materialy projektowe</h2>

                <div id="materials-grid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                    <!-- Materials rendered here -->
                </div>

                <div id="materials-empty" class="text-center py-16">
                    <div class="w-16 h-16 mx-auto mb-4 rounded-full bg-zinc-900 flex items-center justify-center">
                        <i class="ph ph-folder-open text-2xl text-zinc-600"></i>
                    </div>
                    <p class="text-secondary">Brak materialow</p>
                </div>
            </div>

            <!-- TAB: Branding -->
            <div id="tab-branding" class="tab-panel hidden">
                <h2 class="text-lg font-semibold text-white mb-6">Branding</h2>

                <!-- Logos -->
                <div class="mb-8">
                    <h3 class="text-sm font-medium text-secondary uppercase tracking-wider mb-4">Logo</h3>
                    <div id="branding-logos" class="grid grid-cols-2 md:grid-cols-4 gap-4">
                        <!-- Logos rendered here -->
                    </div>
                    <div id="branding-logos-empty" class="card p-8 text-center border-dashed">
                        <p class="text-tertiary">Brak logo</p>
                    </div>
                </div>

                <!-- Colors -->
                <div class="mb-8">
                    <h3 class="text-sm font-medium text-secondary uppercase tracking-wider mb-4">Kolory</h3>
                    <div id="branding-colors" class="flex flex-wrap gap-4">
                        <!-- Colors rendered here -->
                    </div>
                    <p id="branding-colors-empty" class="text-tertiary">Brak kolorow</p>
                </div>

                <!-- Fonts -->
                <div class="mb-8">
                    <h3 class="text-sm font-medium text-secondary uppercase tracking-wider mb-4">Czcionki</h3>
                    <div id="branding-fonts" class="space-y-3">
                        <!-- Fonts rendered here -->
                    </div>
                    <p id="branding-fonts-empty" class="text-tertiary">Brak czcionek</p>
                </div>

                <!-- Guidelines -->
                <div>
                    <h3 class="text-sm font-medium text-secondary uppercase tracking-wider mb-4">Wytyczne</h3>
                    <div id="branding-guidelines" class="space-y-3">
                        <!-- Guidelines rendered here -->
                    </div>
                    <p id="branding-guidelines-empty" class="text-tertiary">Brak wytycznych</p>
                </div>
            </div>

            <!-- TAB: Strona -->
            <div id="tab-strona" class="tab-panel hidden">
                <h2 class="text-lg font-semibold text-white mb-6">Strona sprzedazowa</h2>

                <div id="sales-page-content" class="hidden">
                    <div class="card overflow-hidden">
                        <div class="aspect-video bg-zinc-900">
                            <iframe id="sales-page-iframe" class="w-full h-full" src=""></iframe>
                        </div>
                        <div class="p-4 flex items-center justify-between border-t border-default">
                            <div class="flex items-center gap-3">
                                <span id="sales-page-status" class="badge badge-emerald">
                                    <span class="w-1.5 h-1.5 rounded-full bg-current"></span>
                                    Live
                                </span>
                                <span id="sales-page-url-display" class="text-secondary text-sm truncate max-w-xs"></span>
                            </div>
                            <a id="sales-page-link" href="#" target="_blank" class="text-white hover:text-zinc-300 flex items-center gap-2 text-sm font-medium">
                                Otworz
                                <i class="ph ph-arrow-square-out"></i>
                            </a>
                        </div>
                    </div>
                </div>

                <div id="sales-page-empty" class="text-center py-16">
                    <div class="w-16 h-16 mx-auto mb-4 rounded-full bg-zinc-900 flex items-center justify-center">
                        <i class="ph ph-globe text-2xl text-zinc-600"></i>
                    </div>
                    <p class="text-secondary">Brak strony sprzedazowej</p>
                </div>
            </div>

            <!-- TAB: Produkty -->
            <div id="tab-produkty" class="tab-panel hidden">
                <h2 class="text-lg font-semibold text-white mb-6">Produkty i dostawy</h2>

                <div id="products-list" class="space-y-4">
                    <!-- Products rendered here -->
                </div>

                <div id="products-empty" class="text-center py-16">
                    <div class="w-16 h-16 mx-auto mb-4 rounded-full bg-zinc-900 flex items-center justify-center">
                        <i class="ph ph-package text-2xl text-zinc-600"></i>
                    </div>
                    <p class="text-secondary">Brak produktow</p>
                </div>
            </div>

            <!-- TAB: Raporty -->
            <div id="tab-raporty" class="tab-panel hidden">
                <h2 class="text-lg font-semibold text-white mb-6">Raporty i analizy</h2>

                <div id="reports-list" class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <!-- Reports rendered here -->
                </div>

                <div id="reports-empty" class="text-center py-16">
                    <div class="w-16 h-16 mx-auto mb-4 rounded-full bg-zinc-900 flex items-center justify-center">
                        <i class="ph ph-chart-line-up text-2xl text-zinc-600"></i>
                    </div>
                    <p class="text-secondary">Brak raportow</p>
                </div>
            </div>

            <!-- TAB: Komentarze -->
            <div id="tab-komentarze" class="tab-panel hidden">
                <h2 class="text-lg font-semibold text-white mb-6">Komentarze</h2>

                <div class="max-w-2xl">
                    <div id="comments-list" class="space-y-4 mb-6">
                        <!-- Comments rendered here -->
                    </div>

                    <div id="comments-empty" class="text-center py-12 card mb-6">
                        <div class="w-12 h-12 mx-auto mb-3 rounded-full bg-zinc-800 flex items-center justify-center">
                            <i class="ph ph-chat-circle-text text-xl text-zinc-600"></i>
                        </div>
                        <p class="text-secondary text-sm">Brak komentarzy</p>
                        <p class="text-tertiary text-xs mt-1">Rozpocznij rozmowe ponizej</p>
                    </div>

                    <!-- Add Comment Form -->
                    <div class="card p-4">
                        <textarea id="new-comment" rows="3" class="form-input resize-none mb-3" placeholder="Napisz komentarz..."></textarea>
                        <div class="flex justify-end">
                            <button onclick="postComment()" class="bg-white text-black hover:bg-zinc-200 px-4 py-2 rounded-lg text-sm font-medium transition-colors flex items-center gap-2">
                                <i class="ph ph-paper-plane-tilt"></i>
                                Wyslij
                            </button>
                        </div>
                    </div>
                </div>
            </div>

        </main>

        <!-- Footer -->
        <footer class="border-t border-default mt-auto">
            <div class="max-w-6xl mx-auto px-4 md:px-6 py-6">
                <div class="flex items-center justify-between text-sm text-tertiary">
                    <span>tomekniedzwiecki.pl</span>
                    <a href="mailto:kontakt@tomekniedzwiecki.pl" class="hover:text-secondary transition-colors">Kontakt</a>
                </div>
            </div>
        </footer>
    </div>

    <!-- Toast -->
    <div id="toast" class="fixed bottom-6 right-6 z-50 hidden">
        <div class="bg-zinc-900 border border-zinc-800 text-white px-4 py-3 rounded-lg shadow-lg flex items-center gap-3">
            <i id="toast-icon" class="ph ph-check-circle text-emerald-400"></i>
            <span id="toast-message">Sukces</span>
        </div>
    </div>

    <script>
        const SUPABASE_URL = 'https://yxmavwkwnfuphjqbelws.supabase.co';
        const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Inl4bWF2d2t3bmZ1cGhqcWJlbHdzIiwicm9sZSI6ImFub24iLCJpYXQiOjE3Njg3NjQyNTUsImV4cCI6MjA4NDM0MDI1NX0.XeR0Fc7OFn6YbNJrOKTBEj36JtmLISZTM87y4ai9340';
        const supabaseClient = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

        let workflow = null;
        let milestones = [];
        let tasks = [];
        let documents = [];
        let materials = [];
        let brandingItems = [];
        let products = [];
        let reports = [];
        let comments = [];
        let isAuthenticated = false;

        function getToken() {
            const path = window.location.pathname;
            const match = path.match(/\/projekt\/([a-f0-9]+)/i);
            return match ? match[1] : null;
        }

        function showScreen(screenName) {
            ['loading', 'set-password', 'password', 'not-found', 'contract-data', 'contract-signing', 'project'].forEach(name => {
                const el = document.getElementById(`${name}-screen`);
                if (el) el.classList.toggle('hidden', name !== screenName);
            });
        }

        function showToast(message, type = 'success') {
            const toast = document.getElementById('toast');
            const icon = document.getElementById('toast-icon');
            const msg = document.getElementById('toast-message');

            icon.className = `ph ph-${type === 'success' ? 'check-circle text-emerald-400' : type === 'error' ? 'x-circle text-red-400' : 'info text-blue-400'}`;
            msg.textContent = message;

            toast.classList.remove('hidden');
            setTimeout(() => toast.classList.add('hidden'), 3000);
        }

        // PESEL validation
        function validatePesel(pesel) {
            if (!/^[0-9]{11}$/.test(pesel)) return { valid: false, error: 'PESEL musi miec 11 cyfr.' };
            const weights = [1, 3, 7, 9, 1, 3, 7, 9, 1, 3];
            let sum = 0;
            for (let i = 0; i < 10; i++) sum += parseInt(pesel[i]) * weights[i];
            if ((10 - (sum % 10)) % 10 !== parseInt(pesel[10])) return { valid: false, error: 'Nieprawidlowy PESEL.' };
            return { valid: true };
        }

        // ID validation
        function validateIdNumber(idNumber) {
            const id = idNumber.toUpperCase().replace(/\s/g, '');
            if (!/^[A-Z]{3}[0-9]{6}$/.test(id)) return { valid: false, error: 'Format: 3 litery + 6 cyfr.' };
            return { valid: true };
        }

        async function loadProject() {
            const token = getToken();
            if (!token) { showScreen('not-found'); return; }

            const { data: workflowData, error } = await supabaseClient
                .from('workflows')
                .select('*')
                .eq('unique_token', token)
                .single();

            if (error || !workflowData) { showScreen('not-found'); return; }
            workflow = workflowData;

            if (!workflow.client_password_hash) { showScreen('set-password'); return; }
            if (!isAuthenticated) { showScreen('password'); return; }

            await logAccess();

            // Contract flow
            if (workflow.contract_seller_signed_url || workflow.contract_status === 'signed') {
                // Continue to project
            } else if (workflow.contract_status === 'pending_data') {
                prefillContractForm();
                showScreen('contract-data');
                return;
            } else if (['data_filled', 'pending_signature'].includes(workflow.contract_status)) {
                showScreen('contract-signing');
                return;
            }

            await loadAllData();
            renderProject();
            showScreen('project');
        }

        async function loadAllData() {
            const [milestonesRes, tasksRes, docsRes, matsRes, brandRes, prodsRes, repsRes, comsRes] = await Promise.all([
                supabaseClient.from('workflow_milestones').select('*').eq('workflow_id', workflow.id).order('milestone_index'),
                supabaseClient.from('workflow_tasks').select('*').eq('workflow_id', workflow.id).order('task_index'),
                supabaseClient.from('workflow_documents').select('*').eq('workflow_id', workflow.id).eq('visible_to_client', true).order('uploaded_at', { ascending: false }),
                supabaseClient.from('workflow_materials').select('*').eq('workflow_id', workflow.id).eq('visible_to_client', true).order('uploaded_at', { ascending: false }),
                supabaseClient.from('workflow_branding').select('*').eq('workflow_id', workflow.id).order('sort_order'),
                supabaseClient.from('workflow_products').select('*').eq('workflow_id', workflow.id).order('created_at', { ascending: false }),
                supabaseClient.from('workflow_reports').select('*').eq('workflow_id', workflow.id).eq('visible_to_client', true).order('created_at', { ascending: false }),
                supabaseClient.from('workflow_comments').select('*').eq('workflow_id', workflow.id).order('created_at', { ascending: true })
            ]);

            milestones = milestonesRes.data || [];
            tasks = tasksRes.data || [];
            documents = docsRes.data || [];
            materials = matsRes.data || [];
            brandingItems = brandRes.data || [];
            products = prodsRes.data || [];
            reports = repsRes.data || [];
            comments = comsRes.data || [];
        }

        async function logAccess() {
            try {
                await supabaseClient.from('workflow_access_log').insert({ workflow_id: workflow.id, user_agent: navigator.userAgent });
            } catch (e) {}
        }

        // Password functions
        async function setPassword(e) {
            e.preventDefault();
            const password = document.getElementById('set-password-input').value;
            const confirm = document.getElementById('set-password-confirm').value;

            if (password !== confirm) { showToast('Hasla nie pasuja', 'error'); return; }
            if (password.length < 6) { showToast('Haslo za krotkie', 'error'); return; }

            const hash = dcodeIO.bcrypt.hashSync(password, 10);
            const { error } = await supabaseClient.from('workflows').update({ client_password_hash: hash }).eq('id', workflow.id);

            if (error) { showToast('Blad zapisu', 'error'); return; }

            workflow.client_password_hash = hash;
            isAuthenticated = true;
            loadProject();
        }
        window.setPassword = setPassword;

        async function checkPassword(e) {
            e.preventDefault();
            const password = document.getElementById('password-input').value;

            if (dcodeIO.bcrypt.compareSync(password, workflow.client_password_hash)) {
                isAuthenticated = true;
                loadProject();
            } else {
                showToast('Nieprawidlowe haslo', 'error');
            }
        }
        window.checkPassword = checkPassword;

        // Contract functions
        function prefillContractForm() {
            document.getElementById('contract-name').value = workflow.customer_name || '';
            document.getElementById('contract-company').value = workflow.customer_company || '';
            document.getElementById('contract-email').value = workflow.customer_email || '';
            document.getElementById('contract-phone').value = workflow.customer_phone || '';
            document.getElementById('contract-pesel').value = workflow.client_pesel || '';
            document.getElementById('contract-id').value = workflow.client_id_number || '';
            document.getElementById('contract-nip').value = workflow.client_nip || '';
            document.getElementById('contract-street').value = workflow.client_street || '';
            document.getElementById('contract-postal').value = workflow.client_postal_code || '';
            document.getElementById('contract-city').value = workflow.client_city || '';
            document.getElementById('contract-country').value = workflow.client_country || 'Polska';
        }

        async function submitContractData(e) {
            e.preventDefault();

            const pesel = document.getElementById('contract-pesel').value;
            const idNumber = document.getElementById('contract-id').value;

            const peselResult = validatePesel(pesel);
            if (!peselResult.valid) {
                document.getElementById('pesel-error').textContent = peselResult.error;
                document.getElementById('pesel-error').classList.remove('hidden');
                return;
            }
            document.getElementById('pesel-error').classList.add('hidden');

            const idResult = validateIdNumber(idNumber);
            if (!idResult.valid) {
                document.getElementById('id-error').textContent = idResult.error;
                document.getElementById('id-error').classList.remove('hidden');
                return;
            }
            document.getElementById('id-error').classList.add('hidden');

            const updateData = {
                customer_name: document.getElementById('contract-name').value,
                customer_company: document.getElementById('contract-company').value,
                customer_email: document.getElementById('contract-email').value,
                customer_phone: document.getElementById('contract-phone').value,
                client_pesel: pesel,
                client_id_number: idNumber.toUpperCase(),
                client_nip: document.getElementById('contract-nip').value,
                client_street: document.getElementById('contract-street').value,
                client_postal_code: document.getElementById('contract-postal').value,
                client_city: document.getElementById('contract-city').value,
                client_country: document.getElementById('contract-country').value,
                contract_status: 'data_filled',
                contract_data_filled_at: new Date().toISOString()
            };

            const { error } = await supabaseClient.from('workflows').update(updateData).eq('id', workflow.id);

            if (error) { showToast('Blad zapisu', 'error'); return; }

            Object.assign(workflow, updateData);
            showScreen('contract-signing');
        }
        window.submitContractData = submitContractData;

        function goToProject() {
            loadProject();
        }
        window.goToProject = goToProject;

        // Tab switching
        function switchTab(tabName) {
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.classList.toggle('active', btn.dataset.tab === tabName);
            });
            document.querySelectorAll('.tab-panel').forEach(panel => {
                panel.classList.add('hidden');
            });
            document.getElementById(`tab-${tabName}`).classList.remove('hidden');

            // Load tab-specific data
            switch(tabName) {
                case 'dokumenty': renderDocuments(); break;
                case 'materialy': renderMaterials(); break;
                case 'branding': renderBranding(); break;
                case 'strona': renderSalesPage(); break;
                case 'produkty': renderProducts(); break;
                case 'raporty': renderReports(); break;
                case 'komentarze': renderComments(); break;
            }
        }
        window.switchTab = switchTab;

        // Render functions
        function formatDate(dateStr) {
            if (!dateStr) return '-';
            return new Date(dateStr).toLocaleDateString('pl-PL', { day: 'numeric', month: 'short', year: 'numeric' });
        }

        function formatDateTime(dateStr) {
            if (!dateStr) return '';
            return new Date(dateStr).toLocaleDateString('pl-PL', { day: 'numeric', month: 'short', hour: '2-digit', minute: '2-digit' });
        }

        function renderProject() {
            // Header
            document.getElementById('project-title').textContent = workflow.offer_name || 'Projekt';
            document.getElementById('offer-name').textContent = workflow.offer_name || '-';
            document.getElementById('started-at').textContent = formatDate(workflow.started_at);

            // Status
            const statusBadge = document.getElementById('project-status-badge');
            const statusConfig = {
                active: { class: 'badge-emerald', text: 'Aktywny' },
                completed: { class: 'badge-blue', text: 'Ukonczony' },
                paused: { class: 'badge-amber', text: 'Wstrzymany' },
                cancelled: { class: 'badge-red', text: 'Anulowany' }
            };
            const status = statusConfig[workflow.status] || statusConfig.active;
            statusBadge.className = `badge ${status.class}`;
            statusBadge.innerHTML = `<span class="w-1.5 h-1.5 rounded-full bg-current"></span>${status.text}`;

            // Progress
            const totalTasks = tasks.length;
            const completedTasks = tasks.filter(t => t.completed).length;
            const progressPercent = totalTasks > 0 ? Math.round((completedTasks / totalTasks) * 100) : 0;

            document.getElementById('progress-percent').textContent = progressPercent + '%';
            document.getElementById('completed-tasks').textContent = completedTasks;
            document.getElementById('total-tasks').textContent = totalTasks;

            // Progress ring
            const ring = document.getElementById('progress-ring-fill');
            const circumference = 264;
            ring.style.strokeDashoffset = circumference - (progressPercent / 100 * circumference);

            // Current milestone
            const currentMilestone = milestones.find(m => m.status === 'in_progress');
            document.getElementById('current-milestone').textContent = currentMilestone ? currentMilestone.title : 'Brak';
            document.getElementById('current-deadline').textContent = currentMilestone ? formatDate(currentMilestone.deadline) : '-';

            // Signed contract
            if (workflow.contract_seller_signed_url) {
                document.getElementById('signed-contract-section').classList.remove('hidden');
                document.getElementById('signed-contract-download').href = workflow.contract_seller_signed_url;
            }

            // Milestones
            renderMilestones();
        }

        function renderMilestones() {
            const container = document.getElementById('milestones-container');

            container.innerHTML = milestones.map((milestone, index) => {
                const milestoneTasks = tasks.filter(t => t.milestone_id === milestone.id);
                const completedCount = milestoneTasks.filter(t => t.completed).length;
                const totalCount = milestoneTasks.length;
                const progressPercent = totalCount > 0 ? Math.round((completedCount / totalCount) * 100) : 0;

                const isActive = milestone.status === 'in_progress';
                const isCompleted = milestone.status === 'completed';

                return `
                    <div class="card milestone-card ${isActive ? 'active' : ''} ${isCompleted ? 'completed' : ''} overflow-hidden">
                        <div class="p-4 cursor-pointer" onclick="toggleMilestone('${milestone.id}')">
                            <div class="flex items-center justify-between">
                                <div class="flex items-center gap-3">
                                    <div class="w-8 h-8 rounded-lg flex items-center justify-center ${
                                        isCompleted ? 'bg-emerald-500/10 text-emerald-400' :
                                        isActive ? 'bg-white/10 text-white' :
                                        'bg-zinc-800 text-zinc-500'
                                    }">
                                        ${isCompleted ? '<i class="ph ph-check"></i>' : index + 1}
                                    </div>
                                    <div>
                                        <h3 class="font-medium ${isCompleted || isActive ? 'text-white' : 'text-zinc-400'}">${milestone.title}</h3>
                                        <p class="text-tertiary text-xs">${formatDate(milestone.start_date)} - ${formatDate(milestone.deadline)}</p>
                                    </div>
                                </div>
                                <div class="flex items-center gap-4">
                                    <div class="text-right hidden sm:block">
                                        <p class="text-secondary text-xs">${completedCount}/${totalCount}</p>
                                        <div class="w-20 h-1.5 bg-zinc-800 rounded-full overflow-hidden mt-1">
                                            <div class="h-full ${isCompleted ? 'bg-emerald-500' : 'bg-white'}" style="width: ${progressPercent}%"></div>
                                        </div>
                                    </div>
                                    <i class="ph ph-caret-down text-zinc-500 transition-transform" id="chevron-${milestone.id}"></i>
                                </div>
                            </div>
                        </div>

                        <div id="content-${milestone.id}" class="hidden border-t border-default">
                            <div class="p-4 space-y-2">
                                ${milestoneTasks.map(task => `
                                    <div class="flex items-center gap-3 py-2">
                                        <div class="w-5 h-5 rounded flex items-center justify-center ${task.completed ? 'bg-emerald-500' : 'border border-zinc-700'}">
                                            ${task.completed ? '<i class="ph ph-check text-white text-xs"></i>' : ''}
                                        </div>
                                        <span class="${task.completed ? 'text-zinc-500 line-through' : 'text-white'}">${task.title}</span>
                                        <span class="badge text-[10px] px-2 py-1 responsible-${task.responsible || 'team'}">${
                                            task.responsible === 'client' ? 'Ty' : task.responsible === 'shared' ? 'Wspolnie' : 'Zespol'
                                        }</span>
                                    </div>
                                `).join('')}
                                ${milestoneTasks.length === 0 ? '<p class="text-tertiary text-sm py-2">Brak zadan</p>' : ''}
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
        }

        function toggleMilestone(id) {
            const content = document.getElementById(`content-${id}`);
            const chevron = document.getElementById(`chevron-${id}`);
            content.classList.toggle('hidden');
            chevron.style.transform = content.classList.contains('hidden') ? '' : 'rotate(180deg)';
        }
        window.toggleMilestone = toggleMilestone;

        function renderDocuments() {
            const container = document.getElementById('documents-list');
            const empty = document.getElementById('documents-empty');

            if (documents.length === 0) {
                container.innerHTML = '';
                empty.classList.remove('hidden');
                return;
            }

            empty.classList.add('hidden');
            container.innerHTML = documents.map(d => `
                <div class="card card-hover p-4 flex items-center justify-between">
                    <div class="flex items-center gap-4">
                        <div class="w-10 h-10 rounded-lg bg-red-500/10 flex items-center justify-center">
                            <i class="ph ph-file-pdf text-red-400"></i>
                        </div>
                        <div>
                            <p class="text-white font-medium">${d.title}</p>
                            <p class="text-tertiary text-xs">${d.category || 'Dokument'}  ${formatDate(d.uploaded_at)}</p>
                        </div>
                    </div>
                    <a href="${d.file_url}" target="_blank" class="text-white hover:text-zinc-300 p-2">
                        <i class="ph ph-download-simple text-lg"></i>
                    </a>
                </div>
            `).join('');
        }

        function renderMaterials() {
            const container = document.getElementById('materials-grid');
            const empty = document.getElementById('materials-empty');

            if (materials.length === 0) {
                container.innerHTML = '';
                empty.classList.remove('hidden');
                return;
            }

            empty.classList.add('hidden');
            const fileIcons = { pdf: 'file-pdf', doc: 'file-doc', docx: 'file-doc', jpg: 'file-image', jpeg: 'file-image', png: 'file-image', gif: 'file-image', svg: 'file-image', mp4: 'file-video', zip: 'file-zip' };

            container.innerHTML = materials.map(m => `
                <div class="card card-hover p-4">
                    <div class="flex items-start gap-3">
                        <div class="w-10 h-10 rounded-lg bg-cyan-500/10 flex items-center justify-center flex-shrink-0">
                            <i class="ph ph-${fileIcons[m.file_type?.toLowerCase()] || 'file'} text-cyan-400"></i>
                        </div>
                        <div class="flex-1 min-w-0">
                            <p class="text-white font-medium truncate">${m.title}</p>
                            ${m.description ? `<p class="text-tertiary text-xs line-clamp-2 mt-1">${m.description}</p>` : ''}
                            <p class="text-tertiary text-xs mt-2">${m.category || 'Plik'}</p>
                        </div>
                    </div>
                    <a href="${m.file_url}" target="_blank" class="mt-3 block text-center bg-zinc-800 hover:bg-zinc-700 text-white py-2 rounded-lg text-sm transition-colors">
                        Pobierz
                    </a>
                </div>
            `).join('');
        }

        function renderBranding() {
            const logos = brandingItems.filter(b => b.type === 'logo');
            const colors = brandingItems.filter(b => b.type === 'color');
            const fonts = brandingItems.filter(b => b.type === 'font');
            const guidelines = brandingItems.filter(b => b.type === 'guideline');

            // Logos
            const logosContainer = document.getElementById('branding-logos');
            const logosEmpty = document.getElementById('branding-logos-empty');
            if (logos.length > 0) {
                logosEmpty.classList.add('hidden');
                logosContainer.innerHTML = logos.map(l => `
                    <div class="card p-4 aspect-square flex items-center justify-center">
                        <img src="${l.file_url}" alt="${l.title}" class="max-w-full max-h-full object-contain">
                    </div>
                `).join('');
            } else {
                logosEmpty.classList.remove('hidden');
                logosContainer.innerHTML = '';
            }

            // Colors
            const colorsContainer = document.getElementById('branding-colors');
            const colorsEmpty = document.getElementById('branding-colors-empty');
            if (colors.length > 0) {
                colorsEmpty.classList.add('hidden');
                colorsContainer.innerHTML = colors.map(c => `
                    <div class="flex items-center gap-3 card px-4 py-3">
                        <div class="w-10 h-10 rounded-lg" style="background: ${c.value}"></div>
                        <div>
                            <p class="text-white text-sm">${c.title}</p>
                            <p class="text-tertiary text-xs font-mono">${c.value}</p>
                        </div>
                    </div>
                `).join('');
            } else {
                colorsEmpty.classList.remove('hidden');
                colorsContainer.innerHTML = '';
            }

            // Fonts
            const fontsContainer = document.getElementById('branding-fonts');
            const fontsEmpty = document.getElementById('branding-fonts-empty');
            if (fonts.length > 0) {
                fontsEmpty.classList.add('hidden');
                fontsContainer.innerHTML = fonts.map(f => `
                    <div class="card px-4 py-3 flex items-center justify-between">
                        <div>
                            <p class="text-white">${f.title}</p>
                            <p class="text-tertiary text-sm">${f.value || ''}</p>
                        </div>
                    </div>
                `).join('');
            } else {
                fontsEmpty.classList.remove('hidden');
                fontsContainer.innerHTML = '';
            }

            // Guidelines
            const guidelinesContainer = document.getElementById('branding-guidelines');
            const guidelinesEmpty = document.getElementById('branding-guidelines-empty');
            if (guidelines.length > 0) {
                guidelinesEmpty.classList.add('hidden');
                guidelinesContainer.innerHTML = guidelines.map(g => `
                    <div class="card card-hover px-4 py-3 flex items-center justify-between">
                        <div class="flex items-center gap-3">
                            <i class="ph ph-file-pdf text-red-400"></i>
                            <p class="text-white">${g.title}</p>
                        </div>
                        <a href="${g.file_url}" target="_blank" class="text-white hover:text-zinc-300">
                            <i class="ph ph-download-simple"></i>
                        </a>
                    </div>
                `).join('');
            } else {
                guidelinesEmpty.classList.remove('hidden');
                guidelinesContainer.innerHTML = '';
            }
        }

        function renderSalesPage() {
            const content = document.getElementById('sales-page-content');
            const empty = document.getElementById('sales-page-empty');

            if (workflow.sales_page_url) {
                empty.classList.add('hidden');
                content.classList.remove('hidden');
                document.getElementById('sales-page-iframe').src = workflow.sales_page_url;
                document.getElementById('sales-page-link').href = workflow.sales_page_url;
                document.getElementById('sales-page-url-display').textContent = workflow.sales_page_url;

                const statusBadge = document.getElementById('sales-page-status');
                if (workflow.sales_page_status === 'live') {
                    statusBadge.className = 'badge badge-emerald';
                    statusBadge.innerHTML = '<span class="w-1.5 h-1.5 rounded-full bg-current"></span>Live';
                } else {
                    statusBadge.className = 'badge badge-amber';
                    statusBadge.innerHTML = '<span class="w-1.5 h-1.5 rounded-full bg-current"></span>Draft';
                }
            } else {
                content.classList.add('hidden');
                empty.classList.remove('hidden');
            }
        }

        function renderProducts() {
            const container = document.getElementById('products-list');
            const empty = document.getElementById('products-empty');

            if (products.length === 0) {
                container.innerHTML = '';
                empty.classList.remove('hidden');
                return;
            }

            empty.classList.add('hidden');
            const statusConfig = {
                pending: { class: 'badge-amber', text: 'Oczekuje' },
                in_production: { class: 'badge-blue', text: 'W produkcji' },
                shipped: { class: 'badge-violet', text: 'Wyslany' },
                delivered: { class: 'badge-emerald', text: 'Dostarczony' }
            };

            container.innerHTML = products.map(p => {
                const status = statusConfig[p.status] || statusConfig.pending;
                return `
                    <div class="card p-4">
                        <div class="flex items-start justify-between mb-4">
                            <div class="flex items-center gap-3">
                                <div class="w-10 h-10 rounded-lg bg-orange-500/10 flex items-center justify-center">
                                    <i class="ph ph-package text-orange-400"></i>
                                </div>
                                <div>
                                    <p class="text-white font-medium">${p.name}</p>
                                    ${p.description ? `<p class="text-tertiary text-xs">${p.description}</p>` : ''}
                                </div>
                            </div>
                            <span class="badge ${status.class}">${status.text}</span>
                        </div>
                        <div class="grid grid-cols-3 gap-4 text-sm">
                            <div>
                                <p class="text-tertiary text-xs">Ilosc</p>
                                <p class="text-white">${p.quantity || 1}</p>
                            </div>
                            <div>
                                <p class="text-tertiary text-xs">Dostawa</p>
                                <p class="text-white">${p.estimated_delivery ? formatDate(p.estimated_delivery) : '-'}</p>
                            </div>
                            <div>
                                <p class="text-tertiary text-xs">Nr sledzenia</p>
                                <p class="text-white">${p.tracking_number || '-'}</p>
                            </div>
                        </div>
                        ${p.tracking_url ? `
                            <a href="${p.tracking_url}" target="_blank" class="mt-4 block text-center bg-zinc-800 hover:bg-zinc-700 text-white py-2 rounded-lg text-sm transition-colors">
                                <i class="ph ph-map-pin-line mr-1"></i>
                                Sledz przesylke
                            </a>
                        ` : ''}
                    </div>
                `;
            }).join('');
        }

        function renderReports() {
            const container = document.getElementById('reports-list');
            const empty = document.getElementById('reports-empty');

            if (reports.length === 0) {
                container.innerHTML = '';
                empty.classList.remove('hidden');
                return;
            }

            empty.classList.add('hidden');
            container.innerHTML = reports.map(r => `
                <div class="card p-4">
                    <div class="flex items-start gap-3 mb-3">
                        <div class="w-10 h-10 rounded-lg bg-green-500/10 flex items-center justify-center">
                            <i class="ph ph-chart-line-up text-green-400"></i>
                        </div>
                        <div class="flex-1">
                            <p class="text-white font-medium">${r.title}</p>
                            <p class="text-tertiary text-xs">${r.type || 'Raport'}</p>
                        </div>
                    </div>
                    ${r.period_start && r.period_end ? `
                        <p class="text-tertiary text-xs mb-3">Okres: ${formatDate(r.period_start)} - ${formatDate(r.period_end)}</p>
                    ` : ''}
                    ${r.file_url ? `
                        <a href="${r.file_url}" target="_blank" class="block text-center bg-zinc-800 hover:bg-zinc-700 text-white py-2 rounded-lg text-sm transition-colors">
                            <i class="ph ph-file-pdf mr-1"></i>
                            Pobierz PDF
                        </a>
                    ` : ''}
                </div>
            `).join('');
        }

        function renderComments() {
            const container = document.getElementById('comments-list');
            const empty = document.getElementById('comments-empty');

            if (comments.length === 0) {
                container.innerHTML = '';
                empty.classList.remove('hidden');
                return;
            }

            empty.classList.add('hidden');
            container.innerHTML = comments.map(c => {
                const isTeam = c.author_type === 'team';
                return `
                    <div class="flex gap-3 ${isTeam ? '' : 'flex-row-reverse'}">
                        <div class="w-8 h-8 rounded-full flex-shrink-0 flex items-center justify-center ${isTeam ? 'bg-violet-500/10' : 'bg-cyan-500/10'}">
                            <i class="ph ph-user text-sm ${isTeam ? 'text-violet-400' : 'text-cyan-400'}"></i>
                        </div>
                        <div class="${isTeam ? '' : 'text-right'} flex-1">
                            <div class="inline-block ${isTeam ? 'comment-team' : 'comment-client'} rounded-xl px-4 py-3 max-w-[85%] ${isTeam ? '' : 'text-left'}">
                                <div class="flex items-center gap-2 mb-1">
                                    <span class="text-white text-sm font-medium">${c.author_name}</span>
                                    <span class="text-tertiary text-xs">${formatDateTime(c.created_at)}</span>
                                </div>
                                <p class="text-zinc-300 text-sm whitespace-pre-wrap">${c.content}</p>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');

            // Scroll to bottom
            setTimeout(() => container.scrollTop = container.scrollHeight, 100);
        }

        async function postComment() {
            const content = document.getElementById('new-comment').value.trim();
            if (!content) return;

            const { data, error } = await supabaseClient
                .from('workflow_comments')
                .insert({
                    workflow_id: workflow.id,
                    author_type: 'client',
                    author_name: workflow.customer_name || 'Klient',
                    content: content
                })
                .select()
                .single();

            if (error) {
                showToast('Blad wysylania', 'error');
                return;
            }

            comments.push(data);
            renderComments();
            document.getElementById('new-comment').value = '';
            showToast('Komentarz wyslany');
        }
        window.postComment = postComment;

        // Initialize
        loadProject();
    </script>
</body>
</html>
